domain: messages
name: messages

entity:
  schema:
    dynamicDefaults:        # TODO: drop support for extra keywords
      timestamp: timestamp
    properties:
      sender: id
      text: string
      timestamp: integer

remotes: [ credits.balance ]

operations:
  add:
    input:
      properties:
        sender: ~
        text: ~
      required: [ sender, text ]
    output:
      properties:
        id: ~
      required: [ id ]
    query: false
  get:
    output:
      properties:
        id: ~
        text: ~
        timestamp: ~
      required: [ id, text ]
  update:
    input:
      properties:
        text: ~
      required: [ text ]
  find:
    output:
      properties:
        messages: array
    query: true
  transit:
    input:
      properties:
        sender: ~
        text: ~
      required: [ sender, text ]
    output:
      properties:
        ok: string
      required: [ id ]
