domain: teapots

state:
  name: teapots
  schema:
    properties:
      name:
        type: string
      volume:
        type: number
      material:
        type: string
        enum: [ glass, metal ]
    required: [ name, volume ]
  collection:
    query:
      limit:
        default: 10
        max: 100
      omit: 1000
      sort: name:asc
    projection: [ name ]
  object:
    projection: [ name, volume, material ]

operations:
  add:
    template: ~
    http: /
  update:
    template: ~
    schema:
      properties:
        name: ~
    http: /{_id}
  list:
    template: find
    http:
      - /
      - path: /test
        query:
          criteria: name==test
          limit: 5
          sealed: 1
      - path: /not-test
        query:
          criteria: name!=test
          limit: 5
          frozen: 1
      - path: /messages/{room}/{*perspective}
        query:
          criteria: (sender==*perspective;sent==1),(recipient==*perspective;received==1)
        authorization:
          schema: basic
          rules:
            allow:
              - user: perspective
  get:
    template:
      package: '@kookaburra/templates'
      operation: get
    http: /{_id}
  boil:
    schema:
      properties:
        interval: number
