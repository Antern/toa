domain: messages
transport: amqp

state:
  schema:
    properties:
      sender: string
      recipient: string
      text: string
      status:
        type: string
        enum: [ pending, sent, received, seen ]
        defaut: pending

operations:
  find:
    template: ~
    http:
      - path: /{*user}/{*attendee}
        query: (sender==*user;recipient==*attendee),(sender==*attendee;recipient==*user)
  send:
    http: /{.sender}/{.recipient}
    schema:
      properties:
        sender: ~
        recipient: ~
        text: ~
      required: [ sender, recipient, text ]

remotes:
  - ../credits.accounts
